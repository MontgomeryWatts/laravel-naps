language: php

php:
- 7.1

before_install:
- psql -c 'create database travis_ci_test;' -U postgres

before_script:
- cp .env.travis .env
- composer self-update
- composer install --no-interaction
- php artisan key:generate
- php artisan migrate
- php artisan db:seed
- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
- chmod +x ./cc-test-reporter
- ./cc-test-reporter before-build

script:
- php71-phpdbg -qrr vendor/bin/phpunit -v

after_script:
- ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT

cache:
  directories:
  - node_modules
  - vendor

env:
  global:
  - CC_TEST_REPORTER_ID=97fb196380b79afb82b2829216eb0b7afc246aa5aca6191ff2a3e0c36eb352e9